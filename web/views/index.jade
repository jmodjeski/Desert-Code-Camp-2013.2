extends layout

block head

	link(rel="import", href="elements/framework-resource.html")

block content

	polymer-element(name="meetings-resource", extends="framework-resource")
		script.
			Polymer("meetings-resource", {
				url: '/api/meetings',
				data: [
					{_id:1, title: "Meeting 1"},
					{_id:2, title: "Meeting 2"},
					{_id:3, title: "Meeting 3"},
					{_id:4, title: "Meeting 4"}
				]
			});

	polymer-element(name="meetings-add")
		template
			form.form-inline(role="form", id="addForm", on-submit="formSubmit")
				.form-group
					input.form-control(type="text",value="{{title}}")
				button.btn.btn-default Add Meeting
		script
			Polymer("meetings-add", {
				title: "",
				formSubmit: function(e, sender, detail){
					var self = this;
					e.preventDefault();
					self.fire('add-meeting', {
						title: self.title
					});
				}
			});

	polymer-element(name="meetings-list")
		template
			table.table.table-striped
				thead
					th Title
				tbody
					template(repeat="{{meeting in meetings}}")
						tr
							td
								a(href="/meeting/{{meeting._id}}") {{meeting.title}}
					
		script
			Polymer("meetings-list", {
				meetings: [],
				created: function(){
					var self = this;

					// defers firing of the event 
					// until the page is ready
					self.async(function(){
						self.fire('get-meetings', {});
					})
				}
			});

	polymer-element(name="meetings-app")
		template
			meetings-add(id="add", on-add-meeting="addMeeting")
			meetings-list(id="list", on-get-meetings="loadMeetings")
			meetings-resource(id="meetings", on-query-complete="populateMeetings", on-add-complete="meetingAdded")
		script
			Polymer("meetings-app", {
				loadMeetings: function(e, sender, detail){
					var self = this;
					self.$.meetings.query();
				},
				addMeeting: function(e, sender, detail){
					var self = this;
					self.$.meetings.create(sender);
				},
				populateMeetings: function(e, sender, detail){
					var self = this;
					self.$.list.meetings = sender.data;
				},
				meetingAdded: function(e, sender, detail){
					var self = this;
					self.$.add.title = "";
				}
			});


	.row
		meetings-app.col-md-12

