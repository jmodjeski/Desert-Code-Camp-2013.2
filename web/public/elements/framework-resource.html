<polymer-element name="framework-resource">
		<script>
		(function(){
			function unwrapUrl(url){
				if(typeof url == "Function")
					return url();
				return url;
			};


			Polymer("framework-resource", {
				url: "",
				parse: function(d){
					return d;
				},
				create: function(data){
					var self = this;
					$.ajax({
						url: self.url,
						method: 'POST',
						data: data
					}).done(function(d){
						d = self.parse(d);
						self.data.push(d);
						self.async(function(){
							self.fire('add-complete', {
								data: d
							});
						});
					});
				},
				update: function(id, data){
					var self = this;
					$.ajax({
						url: self.url + '/' + id,
						method: 'PATCH',
						data: data
					}).done(function () {
						self.async(function () {
							self.fire('update-complete', {
								data: data
							});
						});
					});
				},
				remove: function(id){
					var self = this;
					$.ajax({
						url: self.url + "/" + id,
						method: 'DELETE',
						data: {}
					}).done(function(){
						var data = _.remove(self.data, {id:id});
						self.async(function(){
							self.fire('remove-complete', {
								data: data
							});
						});
					});
				},
				fetch: function(id){
					var self = this;
					$.ajax({
						url: self.url + '/' + id,
						method: 'GET'
					}).done(function (data, status, xhr) {
						self.data = data.map(function (d) {
							return self.parse(d);
						});
						self.async(function () {
							self.fire('fetch-complete', {
								data: self.data
							});
						});
					});
				},
				query: function(query){
					var self = this;
					$.ajax({
						url: self.url,
						method: 'GET',
						data: query
					}).done(function(data, status, xhr){
						self.data = data.map(function(d){
							return self.parse(d);
						});
						self.async(function(){
							self.fire('query-complete', {
								data: self.data
							});
						});
					});
				}
			});
		})();
		</script>
</polymer-element>